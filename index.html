<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello!</title>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
    <script src="https://google-ar.github.io/three.ar.js/dist/three.ar.js"></script>
    <script src="https://rawgit.com/chenzlabs/aframe-ar/827e9db/dist/aframe-ar.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/cfe5f316/dist/aframe-extras.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      ul{
        list-style-type: none;
        margin: 0;
        padding: 0;
        position: absolute;
        bottom: 0;
        z-index: 2
      }
      li{
        float: left;
        background-color: white;
        width: 50px;
        height: 50px;
        border-radius: 10px;
        padding: 18px;
        margin-right: 10px;
      }
      #inside{
        border:1px solid orange;
        border-radius: 10px;
        width: 100%;
        height: 100%;
        background: none;
      }
      #text{
        color: blue;
      }
      .a-canvas{
        left: 0px;
        top:0;
        position: absolute;
      }
    </style>
  </head>  
    
<body>
  <video id="video" autoplay muted="true" style="position: absolute;top: 0;left: 0;object-fit: fill;"></video>
  <span id="text" style="z-index: 1;position: absolute;"></span>
  <ul>
    <li><button onclick="display('spidey')" id="inside">Spidey</button></li>
    <li><button onclick="display('sylvanas')" id="inside">Sylvanas</button></li>
  </ul>
  <a-scene ar>
    <a-assets>
      <a-asset id="cesium-man" src="./CesiumMan.glb"></a-asset>
      <a-asset id="spidey-man" src="./spidey.glb"></a-asset>
    </a-assets>
    <a-entity id="walker" gltf-model="#cesium-man" look-controls="enabled: false" position="0 0 -5" scale="0.5 0.5 0.5" animation-mixer></a-entity>
    <a-entity id="walker" gltf-model="#spidey-man" look-controls="enabled: false" position="0 0 -5" scale="0.005 0.005 0.005" animation-mixer></a-entity>
  </a-scene>

  <script type="text/javascript">
    var video = document.querySelector('video');
    video.width=$(window).width();
    video.height=$(window).height();

    document.querySelector("canvas").setAttribute("id","mycanvas")
    var xaxis=document.getElementById("mycanvas").offsetWidth/90;
    var yaxis=document.getElementById("mycanvas").offsetHeight/180;
    console.log(xaxis+" "+yaxis)
    var size=1;
    var arr=["walker","spidey"];
    var pos=[{x:-1,y:1}]

    navigator.mediaDevices.getUserMedia({audio:true,video:{facingMode:{exact:"environment"}}})
    // navigator.mediaDevices.getUserMedia({audio:true,video:true})
    .then(function(stream){
       if ("srcObject" in video) {
        video.srcObject = stream;
       } else {
        video.src = window.URL.createObjectURL(stream); 
       }
       video.onloadedmetadata = function(e) {
        video.play();
       }
     });

    var alpha1,beta1,gamma1;
    
    

    window.onload=function(){
      console.log(document.querySelectorAll("a-entity"))
      var tsm=document.querySelectorAll("a-entity")[1];
      tsm.removeAttribute("look-controls");
    }

    window.addEventListener('deviceorientation', function(event) {
      alpha1 = event.alpha;
      beta1 = Math.round(event.beta);
      gamma1 = Math.round(event.gamma);


      document.getElementById("mycanvas").style.left=(xaxis*gamma1)-0+"px";
      document.getElementById("mycanvas").style.top=(yaxis*beta1)-0+"px";
      document.getElementById("text").innerHTML=document.getElementById("mycanvas").offsetLeft+";"+document.getElementById("mycanvas").offsetTop
      // document.getElementById("text").innerHTML=Math.round(xaxis*gamma1)+";"+Math.round(yaxis*beta1);
    }, false);

    function display(name){
      console.log(name);
      var asset=document.createElement("a-asset");
      asset.setAttribute("src",`${name}.glb`);
      asset.setAttribute("id",`${name}1`);
      var assets=document.querySelector("a-assets");
      assets.append(asset);
      var entity=document.createElement("a-entity");
      entity.setAttribute("gltf-model",`#${name}1`);
      // entity.setAttribute("position",`${gamma1} ${beta1} -5`);
      entity.setAttribute("position",`0 0 -5`);
      entity.setAttribute("scale",`0.005 0.005 0.005`);
      entity.setAttribute("id",`${name}`);
      arr.push(name);
      var obj={x:20*gamma1,y:20*beta1};
      pos.push(obj);
      var scene=document.querySelector("a-scene");
      scene.append(entity);
      size++;
    }

  </script>
</body>
</html>
